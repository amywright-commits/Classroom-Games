<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Series Comma Challenge</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* Light green bg */
        }
        
        .comic-font {
            font-family: 'Comic Neue', cursive;
        }

        .word-token {
            transition: all 0.2s;
        }
        
        .word-token:hover {
            transform: translateY(-2px);
            background-color: #dbeafe;
        }

        .comma-badge {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Inline Icons to avoid library loading errors ---
        const Icon = ({ size = 24, className = "", children }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
                className={className}
            >
                {children}
            </svg>
        );

        const Check = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"></polyline></Icon>;
        const X = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></Icon>;
        const PenTool = (props) => <Icon {...props}><path d="m12 19 7-7 3 3-7 7-3-3z"></path><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="m2 2 7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></Icon>;
        const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const Star = (props) => <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>;
        const Trophy = (props) => <Icon {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M9 22v-4a6 6 0 0 1 12 0v4"></path><path d="m5 4 1 7c0 5 4 9 9 9s9-4 9-9l1-7H5Z"></path></Icon>;
        const ArrowRight = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></Icon>;
        // ----------------------------------------------------

        // Data: Sentences and the indices of words that should have a comma after them
        const SENTENCES = [
            {
                category: "Animals & Nature",
                text: "The zoo is home to lions tigers and bears.",
                correctIndices: [5, 6] // lions(5), tigers(6)
            },
            {
                category: "Animals & Nature",
                text: "My dog loves to run jump and catch frisbees.",
                correctIndices: [4, 5] // run(4), jump(5)
            },
            {
                category: "Animals & Nature",
                text: "The shark had sharp teeth cold eyes and a powerful fin.",
                correctIndices: [4, 6] // teeth(4), eyes(6)
            },
            {
                category: "Animals & Nature",
                text: "We saw a blue jay a cardinal and a robin.",
                correctIndices: [4, 6] // jay(4), cardinal(6)
            },
            {
                category: "Animals & Nature",
                text: "Cows sheep and chickens all live on that farm.",
                correctIndices: [0, 1] // Cows(0), sheep(1)
            },
            {
                category: "School Life",
                text: "Please take out your math book your calculator and a pencil.",
                correctIndices: [5, 7] // book(5), calculator(7)
            },
            {
                category: "School Life",
                text: "We need glue scissors markers and glitter.",
                correctIndices: [2, 3, 4] // glue(2), scissors(3), markers(4)
            },
            {
                category: "School Life",
                text: "The cafeteria served pizza salad and apples today.",
                correctIndices: [3, 4] // pizza(3), salad(4)
            },
            {
                category: "School Life",
                text: "Our teacher is kind funny and smart.",
                correctIndices: [3, 4] // kind(3), funny(4)
            },
            {
                category: "School Life",
                text: "To succeed you need focus hard work and a good attitude.",
                correctIndices: [3, 5] // focus(3), work(5)
            }
        ];

        const App = () => {
            const [view, setView] = useState('learn'); // learn, practice, create
            const [score, setScore] = useState(0);

            return (
                <div className="min-h-screen pb-12">
                    {/* Navigation Bar */}
                    <nav className="bg-white shadow-md p-4 sticky top-0 z-10 border-b-4 border-green-500">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <h1 className="text-2xl font-bold text-green-700 flex items-center gap-2 comic-font">
                                <PenTool size={28} />
                                The Writer's Gym
                            </h1>
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => setView('learn')}
                                    className={`px-4 py-2 rounded-full font-bold transition ${view === 'learn' ? 'bg-green-100 text-green-700 ring-2 ring-green-500' : 'text-gray-500 hover:bg-gray-100'}`}
                                >
                                    Learn It
                                </button>
                                <button 
                                    onClick={() => setView('practice')}
                                    className={`px-4 py-2 rounded-full font-bold transition ${view === 'practice' ? 'bg-blue-100 text-blue-700 ring-2 ring-blue-500' : 'text-gray-500 hover:bg-gray-100'}`}
                                >
                                    Fix It
                                </button>
                                <button 
                                    onClick={() => setView('create')}
                                    className={`px-4 py-2 rounded-full font-bold transition ${view === 'create' ? 'bg-purple-100 text-purple-700 ring-2 ring-purple-500' : 'text-gray-500 hover:bg-gray-100'}`}
                                >
                                    Write It
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content Area */}
                    <main className="max-w-3xl mx-auto mt-8 px-4">
                        {view === 'learn' && <LearnSection onNext={() => setView('practice')} />}
                        {view === 'practice' && <PracticeSection score={score} setScore={setScore} onComplete={() => setView('create')} />}
                        {view === 'create' && <CreateSection />}
                    </main>
                </div>
            );
        };

        const LearnSection = ({ onNext }) => {
            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="bg-white rounded-2xl p-8 shadow-lg border-2 border-green-100">
                        <h2 className="text-3xl font-bold text-gray-800 mb-4 comic-font">The Series Comma Rule</h2>
                        <div className="bg-yellow-50 p-6 rounded-xl border border-yellow-200 mb-6">
                            <p className="text-lg text-gray-800 leading-relaxed">
                                <span className="font-bold text-xl block mb-2">Here at Breck, we have a rule:</span>
                                When you list <span className="font-bold text-green-600 bg-green-100 px-2 rounded">more than two things</span> in a sentence, 
                                you must use a comma to separate every item.
                                <br/><br/>
                                <span className="font-bold text-red-500">Important:</span> Don't forget the last comma right before the word "and" or "or"!
                            </p>
                        </div>

                        <div className="mt-8">
                            <h3 className="text-xl font-bold text-gray-700 mb-4 flex items-center gap-2">
                                <BookOpen className="text-blue-500"/>
                                The "Platypus" Example
                            </h3>
                            <div className="bg-blue-50 p-6 rounded-xl border border-blue-200">
                                <p className="text-lg md:text-xl leading-relaxed font-medium text-gray-700">
                                    "With his new flat tail<span className="text-white bg-red-500 px-2 py-0.5 rounded mx-1 font-bold shadow-sm">,</span> 
                                    his new bill<span className="text-white bg-red-500 px-2 py-0.5 rounded mx-1 font-bold shadow-sm">,</span> 
                                    and his newly webbed paws, Platypus went on his way."
                                </p>
                                <p className="mt-4 text-sm text-blue-600 italic">
                                    ðŸ‘† See those red blocks? Those are the commas keeping the items separate!
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="text-center">
                        <button 
                            onClick={onNext}
                            className="bg-green-500 hover:bg-green-600 text-white text-xl font-bold py-4 px-12 rounded-full shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition flex items-center gap-3 mx-auto"
                        >
                            Ready to Practice? <ArrowRight />
                        </button>
                    </div>
                </div>
            );
        };

        const PracticeSection = ({ onComplete, score, setScore }) => {
            const [currentIdx, setCurrentIdx] = useState(0);
            const [userCommas, setUserCommas] = useState(new Set());
            const [status, setStatus] = useState('playing'); // playing, correct, wrong

            const currentSentence = SENTENCES[currentIdx];
            const words = currentSentence.text.split(' ');

            const toggleComma = (index) => {
                if (status !== 'playing') return;
                // Cannot put comma after last word
                if (index === words.length - 1) return;

                const newCommas = new Set(userCommas);
                if (newCommas.has(index)) {
                    newCommas.delete(index);
                } else {
                    newCommas.add(index);
                }
                setUserCommas(newCommas);
            };

            const checkAnswer = () => {
                const correctSet = new Set(currentSentence.correctIndices);
                
                // Check if sets match exactly
                let isCorrect = true;
                if (userCommas.size !== correctSet.size) isCorrect = false;
                userCommas.forEach(idx => {
                    if (!correctSet.has(idx)) isCorrect = false;
                });

                if (isCorrect) {
                    setStatus('correct');
                    if (status === 'playing') setScore(s => s + 10);
                } else {
                    setStatus('wrong');
                }
            };

            const nextSentence = () => {
                if (currentIdx < SENTENCES.length - 1) {
                    setCurrentIdx(currentIdx + 1);
                    setUserCommas(new Set());
                    setStatus('playing');
                } else {
                    onComplete();
                }
            };

            const retry = () => {
                setStatus('playing');
                setUserCommas(new Set());
            };

            return (
                <div className="max-w-3xl mx-auto">
                    <div className="flex justify-between items-end mb-4">
                        <h2 className="text-2xl font-bold text-gray-800 comic-font">Fix-It Mission</h2>
                        <div className="flex items-center gap-2 bg-yellow-100 px-4 py-1 rounded-full text-yellow-800 font-bold">
                            <Star className="text-yellow-500 fill-yellow-500" size={20} />
                            Score: {score}
                        </div>
                    </div>

                    <div className="bg-white rounded-2xl p-8 shadow-lg border-2 border-blue-100 min-h-[300px] flex flex-col justify-between">
                        <div>
                            <div className="flex justify-between text-gray-400 text-sm mb-6 uppercase tracking-wider font-bold">
                                <span>{currentSentence.category}</span>
                                <span>Sentence {currentIdx + 1} of {SENTENCES.length}</span>
                            </div>

                            <p className="text-gray-600 mb-4 italic">
                                Click the words to add a comma after them!
                            </p>

                            <div className="flex flex-wrap gap-y-4 text-2xl md:text-3xl font-medium leading-loose">
                                {words.map((word, idx) => (
                                    <div key={idx} className="flex items-center group">
                                        <span 
                                            onClick={() => toggleComma(idx)}
                                            className={`
                                                cursor-pointer px-1 rounded transition select-none
                                                ${status === 'playing' ? 'hover:bg-blue-100 hover:text-blue-800' : ''}
                                                ${status === 'correct' && currentSentence.correctIndices.includes(idx) ? 'text-green-600' : ''}
                                            `}
                                        >
                                            {word}
                                        </span>
                                        {/* Comma Display */}
                                        <div 
                                            className="w-4 flex justify-center items-end"
                                            style={{height: '100%'}}
                                        >
                                            {userCommas.has(idx) && (
                                                <span className="text-red-500 font-bold text-4xl leading-none -ml-1 -mb-1 comma-badge">,</span>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Feedback Area */}
                        <div className="mt-8 border-t pt-6">
                            {status === 'playing' && (
                                <button 
                                    onClick={checkAnswer}
                                    className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md transition text-lg"
                                >
                                    Check My Commas
                                </button>
                            )}

                            {status === 'correct' && (
                                <div className="bg-green-100 p-4 rounded-xl border border-green-300 flex justify-between items-center animate-bounce-short">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-green-500 text-white p-2 rounded-full">
                                            <Check size={24} />
                                        </div>
                                        <div>
                                            <p className="font-bold text-green-800 text-lg">Awesome job!</p>
                                            <p className="text-green-700 text-sm">You found the list items.</p>
                                        </div>
                                    </div>
                                    <button onClick={nextSentence} className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold shadow transition flex items-center gap-2">
                                        Next <ArrowRight size={18} />
                                    </button>
                                </div>
                            )}

                            {status === 'wrong' && (
                                <div className="bg-red-100 p-4 rounded-xl border border-red-300 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-red-500 text-white p-2 rounded-full">
                                            <X size={24} />
                                        </div>
                                        <div>
                                            <p className="font-bold text-red-800 text-lg">Not quite right.</p>
                                            <p className="text-red-700 text-sm">Remember the comma before "and"!</p>
                                        </div>
                                    </div>
                                    <button onClick={retry} className="bg-white text-red-600 hover:bg-red-50 border border-red-200 px-6 py-2 rounded-lg font-bold shadow transition flex items-center gap-2">
                                        <RotateCcw size={18} /> Try Again
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const CreateSection = () => {
            // Store answers and feedback for all challenges
            const [answers, setAnswers] = useState({});

            const handleInput = (id, text) => {
                let feedback = null;
                if (text) {
                    const commaCount = (text.match(/,/g) || []).length;
                    if (commaCount >= 2) {
                        feedback = { type: 'success', msg: "Great! That looks like a list with the Breck comma!" };
                    } else if (commaCount === 1) {
                        feedback = { type: 'warning', msg: "I see one comma. If you have 3 items, you need 2 commas!" };
                    } else {
                        feedback = { type: 'neutral', msg: "Keep typing... make sure to list 3 things." };
                    }
                }
                
                setAnswers(prev => ({
                    ...prev,
                    [id]: { text, feedback }
                }));
            };

            const challenges = [
                { 
                    id: 1, 
                    title: "1. The Ultimate Feast", 
                    prompt: "Write a sentence listing your 3 favorite foods.", 
                    placeholder: "Example: I love pizza, tacos, and ice cream.", 
                    color: "border-purple-500", 
                    focus: "focus:border-purple-500"
                },
                { 
                    id: 2, 
                    title: "2. Weekend Fun", 
                    prompt: "Write a sentence listing 3 things you do on weekends.", 
                    placeholder: "On Saturdays I sleep, play games, and read.", 
                    color: "border-pink-500", 
                    focus: "focus:border-pink-500"
                },
                { 
                    id: 3, 
                    title: "3. Monster Maker", 
                    prompt: "Describe a monster with 3 weird body parts.", 
                    placeholder: "My monster has three eyes, purple fur, and giant claws.", 
                    color: "border-orange-500", 
                    focus: "focus:border-orange-500"
                },
                { 
                    id: 4, 
                    title: "4. Magic Potion", 
                    prompt: "List 3 gross or magical ingredients for a potion.", 
                    placeholder: "Mix together frog legs, spider webs, and moon dust.", 
                    color: "border-green-500", 
                    focus: "focus:border-green-500"
                },
                { 
                    id: 5, 
                    title: "5. Backpack Surprise", 
                    prompt: "List 3 weird things you found in the bottom of your backpack.", 
                    placeholder: "I found an old sandwich, a lost sock, and a glowing rock.", 
                    color: "border-blue-500", 
                    focus: "focus:border-blue-500"
                }
            ];

            return (
                <div className="animate-fade-in pb-10">
                    <div className="text-center mb-8">
                        <div className="inline-block p-4 bg-purple-100 rounded-full mb-4">
                            <Trophy size={48} className="text-purple-600" />
                        </div>
                        <h2 className="text-3xl font-bold text-gray-800 comic-font">Creative Challenge</h2>
                        <p className="text-gray-600 mt-2">Now it's your turn to be the author.</p>
                    </div>

                    <div className="space-y-6">
                        {challenges.map(c => {
                            const answer = answers[c.id] || { text: '', feedback: null };
                            return (
                                <div key={c.id} className={`bg-white p-6 rounded-2xl shadow-md border-l-8 ${c.color}`}>
                                    <h3 className="text-xl font-bold text-gray-800 mb-2">
                                        {c.title}
                                    </h3>
                                    <p className="text-gray-500 mb-4">{c.prompt}</p>
                                    <input 
                                        type="text" 
                                        value={answer.text}
                                        onChange={(e) => handleInput(c.id, e.target.value)}
                                        placeholder={c.placeholder}
                                        className={`w-full p-4 text-lg border-2 border-gray-200 rounded-xl ${c.focus} focus:outline-none transition`}
                                    />
                                    {answer.feedback && (
                                        <div className={`mt-3 text-sm font-bold flex items-center gap-2 
                                            ${answer.feedback.type === 'success' ? 'text-green-600' : 
                                              answer.feedback.type === 'warning' ? 'text-orange-500' : 'text-gray-500'}`}>
                                            {answer.feedback.type === 'success' ? <Check size={16}/> : <PenTool size={16}/>}
                                            {answer.feedback.msg}
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>